<!DOCTYPE html>
<html lang="es">
<head>
	<!--Import Google Icon Font-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!--Import materialize.css-->
	<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
</head>
<body>
	<!-- Modal Structure -->
  <div id="modal1" class="modal">
    <div class="modal-content">
      <h4>Mensaje</h4>
      <p>¡El cliente con el documento <strong id="documento-label"></strong> no existe!</p>
    </div>
    <div class="modal-footer">
    	<a href="#" id="crear-button" class="waves-effect waves-green btn-flat green-text">Crear</a>
    	<a href="#!" class="modal-close waves-effect waves-green btn-flat red-text">Salir</a>      
    </div>
  </div>
          
	<div class="preloader-background">
		<div class="preloader-wrapper big active">
			<div class="spinner-layer spinner-blue-only">
				<div class="circle-clipper left">
					<div class="circle"></div>
				</div>
				<div class="gap-patch">
					<div class="circle"></div>
				</div>
				<div class="circle-clipper right">
					<div class="circle"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- Dropdown Structure -->
	<ul id="dropdown1" class="dropdown-content">		
		<li class="divider"></li>
		<li><a href="#!">Salir</a></li>
	</ul>
	<nav>
		<div class="nav-wrapper indigo">
			<a href="#!" class="brand-logo center">LEONUX</a>
			<ul class="right hide-on-med-and-down">
				<!--<li><a href="sass.html">Sass</a></li>
				<li><a href="badges.html">Components</a></li>-->
				<!-- Dropdown Trigger -->
				<li><a class="dropdown-trigger" href="#!" data-target="dropdown1"><span class="usuario">Usuario</span><i class="material-icons right">arrow_drop_down</i></a></li>
			</ul>
		</div>
	</nav>
		
	<section class="section"></section>
	<div class="container">
		<div id="search-form" class="z-depth-1 grey lighten-4 row" style=" padding: 32px 48px 0px 48px; border: 1px solid #EEE;">
			<h6 class="center"><strong>BUSCAR CLIENTES</strong></h6>
			<form class="col s12 m10 offset-m1" id="cliente">			
				<div class="row">
					<div class="input-field col s6 m3">
						<label>
							<input name="radio_tipo" type="radio" value="ci_rif" checked/>
							<span>CI/RIF</span>
						</label>
					</div>
					<div class="input-field col s6 m3">
						<label>
							<input name="radio_tipo" type="radio" value="nombre"/>
							<span>Nombre</span>
						</label>
					</div>
				</div>
				<div class='row valign-wrapper'>					
					<div id="select_document" class='input-field col s3 m2'>
						<select id="tipo" name="tipo">
							<option value="V" selected>V</option>
							<option value="E">E</option>
							<option value="J">J</option>
							<option value="G">G</option>
							<option value="P">P</option>
						</select>
					</div>
					<div id="input-field__documento" class='input-field col s6 m7'>
						<input class='validate' type='number' name='documento' id='documento' />
						<label id="label_document" for='documento'>Documento</label>
					</div>
					<div class='input-field col s3 m2'>
						<button id='btn_search' name='btn_search' class='col s12 btn waves-effect indigo'>B</button>
					</div>
				</div>
			</form>			
		</div>
		<div id="create-form" class="z-depth-1 grey lighten-4 row" style="display:none; padding: 32px 48px 0px 48px; border: 1px solid #EEE;">
			<h6 class="center"><strong>CREAR CLIENTE</strong></h6>
			<form class="col s12 m10 offset-m1" id="crear-cliente">				
				<div class='row valign-wrapper'>										
					<div id="input-field__documento" class='input-field col s12'>
						<input class='validate' type='text' name='ci_rif' id='doc' disabled/>
						<label id="label_doc" for='doc'>Documento</label>
					</div>
				</div>
				<div class='row valign-wrapper'>										
					<div id="input-field__documento" class='input-field col s12'>
						<input class='validate' type='text' name='razon_social' id='nombre'/>
						<label for='nombre'>Nombre/Razon Social</label>
					</div>
				</div>
				<div class='row valign-wrapper'>										
					<div id="input-field__documento" class='input-field col s12'>
						<input class='validate' type='text' name='telefono' id='telefono'/>
						<label for='telefono'>Teléfono: </label>
					</div>
				</div>
				<div class='row valign-wrapper'>										
					<div id="input-field__documento" class='input-field col s12'>
						<input class='validate' type='text' name='direccion' id='direccion'/>
						<label for='direccion'>Dirección: </label>
					</div>
				</div>
				<div class="row valign-wrapper">
					<div id="select_contribuyente" class='input-field col s12'>
						<select id="contribuyente" name="contribuyente">
							<option value="normal" selected>Contribuyente ordinario</option>
							<option value="especial">Contribuyente especial</option>
						</select>
					</div>
				</div>
				<div class="row">
					<button type="submit" href="#" class='col s12 btn btn-large waves-effect indigo'>CREAR CLIENTE</button>
				</div>
			</form>			
		</div>
		<div class="row">
			<a name='btn_login' href="#" class='col s12 btn btn-large waves-effect indigo'>CONSULTAR PRECIOS</a>
		</div>
	</div>
	<!--JavaScript at end of body for optimized loading-->
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/materialize.min.js"></script>
	<script>
		window.searchByName = false;

		function cambiarTipo(){
			window.searchByName = !window.searchByName;

			// si es por nombre
			if (window.searchByName){
				$("#select_document").hide();
				$("#label_document").text("Nombre");
				$("#input-field__documento").attr("class", "input-field col s10 m10");
			} else {
				// si es por ci/rif
				$("#select_document").show();
				$("#label_document").text("Documento");
				$("#input-field__documento").attr("class", "input-field col s6 m7");
			}
		}

		$(document).ready(function(){
			$(".dropdown-trigger").dropdown();
			$('select').formSelect();
			$('#label_doc').toggleClass('active');

			const elem = document.getElementById('modal1');
			const mod = M.Modal.init(elem, {dismissible: false});

			var usuario = window.localStorage.getItem("usuario");
			if (usuario != null && usuario != ""){
				$('.preloader-background').delay(1700).fadeOut('slow');
				$('.preloader-wrapper').delay(1700).fadeOut();

				window.currentUser = JSON.parse(usuario);								

				$('.usuario').text(currentUser.nombre);

				$('input[type=radio][name=radio_tipo]').on('change', function(){
					cambiarTipo();
				})
				
			} else {
				window.location.replace("index.html");
			}

			//listener para el boton del modal para crear cliente
			$('#crear-button').on('click', function(e){
				e.preventDefault();
				$('#create-form').show();
				$('#search-form').hide();
				mod.close();
			});

			//listener para el submit del form para crear cliente

			$('#create-form').on('submit', function(e){
				e.preventDefault();
				
				$.post("/servicios.php?s=create_cliente", $('#create-form').serialize(), function(data) {
					alert(data);
					let info = JSON.parse(data);
					if(info.error){
						// si hay error

					}else{
						// si no hay error
					}
					
				}).fail(function(err){
					console.log(err);
				});


			});

			// listener para el submit del form para buscar cliente
			$('#cliente').on('submit', function(e){
				e.preventDefault();

				$('#btn_search').attr("disabled", true);

				let documento = $('#documento').val();
				let tipo = $('#tipo').val();
				var ci_rif = tipo + documento;

				if (tipo != "J" && tipo != "G"){
					$('#select_contribuyente').hide();
				} else {
					$('#select_contribuyente').show();
				}

				if (documento === "" || documento === null) {
					alert("Debes ingresar el Nº de documento");
				} else {
					$.post("/servicios.php?s=get_cliente", { ci_rif: ci_rif}, function(data) {
						let info = JSON.parse(data);						
						if(info.error){
							//alert(info.mensaje);
							$('#btn_search').attr("disabled", false);
							$('#doc').val(ci_rif);							

							mod.open();
						}else{
							
							// si el cliente existe

							$('#btn_search').attr("disabled", false);
						}
						
					}).fail(function(err){
						console.log(err);
					});
				}

				
			});
		});
		
	</script>
</body>
</html>